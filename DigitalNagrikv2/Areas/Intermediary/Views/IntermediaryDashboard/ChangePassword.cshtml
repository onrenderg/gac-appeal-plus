@model DigitalNagrik.Areas.Intermediary.Data.ChangePasswordIntermediary
@{
    ViewBag.Title = "ChangePassword";
    string IsPasswordSet = ViewBag.IsPasswordSet;
    Layout = "~/Views/Shared/_LayoutIntermediary.cshtml";
    Dictionary<string, string> LabelDictionary = ViewData["LabelDictionary"] as Dictionary<string, string>;
}
<script src="@Url.Content("~/assets/js/jquery.validate.min.js")"></script>
<script src="@Url.Content("~/assets/js/jquery.validate.unobtrusive.min.js")"></script>
<script src="@Url.Content("~/assets/js/jquery.validate.custom.js")"></script>
<link href="@Url.Content("~/assets/alertifyjs/css/alertify.min.css")" rel="stylesheet" />
<script src="@Url.Content("~/assets/alertifyjs/alertify.min.js")"></script>
<style>
    .min-vh-30 {
        min-height: 70vh !important;
    }
</style>
<div class="container no-padding bg-light min-vh-30" style="font-size:18px">
    <div class="row">
        <div class="col-lg-6">
            <h3 class="mb-0" style="color: black;margin-left:10px; margin-top: 10px;"><i class="bx bx-key me-1"></i>@LabelDictionary["ChangePassword"] </h3>
        </div>
        <div class="col-lg-6 mt-1">
            <a class="btn btn-warning btn-sm float-end" href='@Url.Action("Index", "IntermediaryDashboard", new {Area="Intermediary"})'>
                <i class="bx bx-arrow-back align-middle"></i> @LabelDictionary["Back"]
            </a>
        </div>
    </div>
    <hr />
    <div class="row">
        <div class="col-7">
            @using (Html.BeginForm("UpdatePassword", "IntermediaryDashboard", FormMethod.Post, new { id = "frm_ChangePassword", enctype = "multipart/form-data" }))
            {
                @Html.AntiForgeryToken()
                @Html.HiddenFor(x => x.HashCurrentPassword)
                @Html.HiddenFor(x => x.HashNewPassword)
                @Html.HiddenFor(x => x.IsPasswordSet)
                if (IsPasswordSet == "Y")
                {
                    <div class="row">
                        <div class="col-lg-4">
                            <label class="custom-input-label mb-1">@LabelDictionary["CurrentPassword"]</label><span class="text-danger"> *</span>
                        </div>
                        <div class="col-lg-8 mb-3">
                            @Html.TextBoxFor(x => x.CurrentPassword, new { @id = "CurrentPassword", @Type = "Password", @class = "form-control DisabledInputs", placeholder = @LabelDictionary["CurrentPassword"], @autocomplete = "off" })
                            @Html.ValidationMessageFor(x => x.CurrentPassword)
                        </div>
                    </div>
                }
                <div class="row">
                    <div class="col-lg-4">
                        <label class="custom-input-label mb-1">@LabelDictionary["NewPassword"]</label><span class="text-danger"> *</span>
                    </div>
                    <div class="col-lg-8 mb-3">
                        @Html.TextBoxFor(x => x.NewPassword, new { @id = "NewPassword", @class = "form-control DisabledInputs", @Type = "Password", placeholder = @LabelDictionary["NewPassword"], @autocomplete = "off" })
                        @Html.ValidationMessageFor(x => x.NewPassword)
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-4">
                        <label class="custom-input-label mb-1">@LabelDictionary["ConfirmPassword"]</label><span class="text-danger"> *</span>
                    </div>
                    <div class="col-lg-8 mb-3">
                        @Html.TextBoxFor(x => x.ConfirmNewPassword, new { @id = "ConfirmNewPassword", @class = "form-control DisabledInputs", @Type = "Password", placeholder = @LabelDictionary["ConfirmPassword"], @autocomplete = "off" })
                        @Html.ValidationMessageFor(x => x.ConfirmNewPassword)
                    </div>
                </div>
                <div class="row mt-2">
                    <div class="col-lg-12 text-center">
                        <button type="button" class="btn btn-primary" id="btnSendOTP">@LabelDictionary["SendOTP"]</button>
                    </div>
                </div>
                <div id="divOTP"></div>
            }
        </div>
        <div class="col-5">
            <div class="margin-bottom-20" id="divInstructions">
                <h4>
                    <span style="color: red">* </span>
                    <label style="text-decoration: underline;">@LabelDictionary["PasswordHeading"]</label>
                </h4>
                <table class="table-condensed" style="width: 100%">
                    <tbody>
                        <tr>
                            <td style="width: 3%; vertical-align: top;"><i class="bx bxs-hand-right text-black"></i></td>
                            <td>@LabelDictionary["PasswordHeading1"]</td>
                        </tr>
                        <tr>
                            <td style="vertical-align: top;"><i class="bx bxs-hand-right text-black"></i></td>
                            <td>@LabelDictionary["PasswordHeading2"]</td>
                        </tr>
                        <tr>
                            <td style="vertical-align: top;"><i class="bx bxs-hand-right text-black"></i></td>
                            <td>@LabelDictionary["PasswordHeading3"]</td>
                        </tr>
                        <tr>
                            <td style="vertical-align: top;"><i class="bx bxs-hand-right text-black"></i></td>
                            <td>@LabelDictionary["PasswordHeading4"]</td>
                        </tr>
                        <tr>
                            <td style="vertical-align: top;"><i class="bx bxs-hand-right text-black"></i></td>
                            <td>@LabelDictionary["PasswordHeading5"]</td>
                        </tr>
                    </tbody>

                </table>
            </div>
        </div>
    </div>
</div>
@if (!string.IsNullOrEmpty(Convert.ToString(TempData["Status"])))
{
    string AlertFlag = Convert.ToString(TempData["Status"]);
    string AlertMessage = !string.IsNullOrWhiteSpace(Convert.ToString(TempData["Status_Msg"])) ? Convert.ToString(TempData["Status_Msg"]) : string.Empty;
    string AlertType = !string.IsNullOrWhiteSpace(Convert.ToString(TempData["Status_Type"])) ? Convert.ToString(TempData["Status_Type"]) : string.Empty;
    string IconClass = "bx-check-circle";
    switch (AlertFlag)
    {
        case "S":
            AlertMessage = "Successfully Saved"; AlertType = "success";
            break;
        case "U":
            AlertMessage = "Successfully Updated"; AlertType = "success";
            break;
        case "D":
            AlertMessage = "Successfully Deleted"; AlertType = "success";
            break;
        case "O":
            IconClass = "bx-info-circle";
            break;
        default:
            IconClass = "bx-x-circle";
            AlertMessage = "Failed to process your request. Please contact your administrator if problem persists"; AlertType = "error"; IconClass = "bx-x-circle";
            break;
    }
    if (!string.IsNullOrEmpty(AlertMessage) && !string.IsNullOrEmpty(AlertType))
    {
        <script type="text/javascript">
                $(function () {
                    alertify.notify("<div class='animated fadeIn m-0'><i class='bx @IconClass me-1'></i> @AlertMessage </div>", "@AlertType", 5, function () { });
                });
        </script>
    }
}
@if (!string.IsNullOrEmpty(Convert.ToString(TempData["AlertStatus"])))
{
    DigitalNagrik.Models.BALCommon.CustomClientAlerts Alert = (DigitalNagrik.Models.BALCommon.CustomClientAlerts)TempData["AlertStatus"]; TempData["AlertStatus"] = null;
    <script type="text/javascript">
            $(function () { alertify.alert("<h5 class='m-0'><i class='bx @Alert.AlertIcon @Alert.AlertColor me-1'></i> @Alert.AlertTitle</h5>", "@Html.Raw(Alert.AlertMessage)", function () { }); });
    </script>
}
<script src=@Url.Content("~/assets/js/sha256.js")></script>
<script>
    var loadhtml = "<div class='padding-vert-10 text-muted padding-horiz-10 text-center'><i class='fa fa-2x fa-spinner fa-spin'></i><br /> Sending OTP. Please wait ...</div>";
    $("#btnSendOTP").click(function () {
        if ($("#frm_ChangePassword").valid()) {
           if ('@IsPasswordSet' == "Y") {
                $("#HashCurrentPassword").val(sha256($("#CurrentPassword").val()));
                $("#CurrentPassword").rules("remove", "required");
                $("#CurrentPassword").val("");
                $("#IsPasswordSet").val("Y");
            }

            $("#HashNewPassword").val(sha256($("#NewPassword").val()));
            $("#NewPassword").rules("remove", "required");
            $("#ConfirmNewPassword").rules("remove", "required");
            $("#NewPassword").val(""); $("#ConfirmNewPassword").val("");
            $('.DisabledInputs').attr('readonly', true);
            DisplayOTPGrid();
        }
    });
     function DisplayOTPGrid() {
         $("#divOTP").html(loadhtml);
            $('#btnSendOTP').hide();
            $.ajax({
                url: '@Url.Action("SendOTPtoIntermediary", "IntermediaryDashboard", new { Area = "Intermediary" })',
                type: "GET",
                dataType: "html",
                success: function (data) {
                    if (data) {
                        $("#divOTP").html('');
                        $("#divOTP").html(data);
                        $("#divOTP").focus();
                    }
                },
                error: function () {
                    $("#divOTP").html('');
                }
            });
        }
</script>

