@model DigitalNagrik.Areas.GridView.Data.GACRecomendations
@{
    Dictionary<string, string> LabelDictionary = ViewBag.LabelDictionary as Dictionary<string, string>;
}
<style>
    .gv-container-comparison-doc {
        width: 50% !important;
    }

    @@media (max-width:991px) {
        .gv-container-comparison-doc {
            width: 100% !important;
        }
    }
</style>
<div class="modal-header pt-3">
    <h4 class="modal-title">@LabelDictionary["MemberOpinion"] (@Model.UserName) (<span class="h5">@LabelDictionary["AppealNumber"]: </span><span>@Model.GrievanceId/@Model.RegistrationYear</span>)</h4>
    <button type="button" class="btn-close" data-bs-dismiss="modal" onclick="CloseTab($(this))" data-url="@Url.Action("UpdateWindowOpenedStatus", "GACGridViewInbox", new { Area = "GridView" })" data-qs="@SecureQueryString.SecureQueryString.Encrypt("RegistrationYear=" + @Model.RegistrationYear +"&GrievanceId="+Model.GrievanceId)" aria-label="Close"></button>
</div>
<hr class="mb-0 mt-2" />
@using (Html.BeginForm("GACRecomendation", "GACGridViewInbox", FormMethod.Post, new { @class = "frmGACRecomendations" }))
{
    @Html.AntiForgeryToken()
    @Html.ValidationSummary(true)
    @Html.HiddenFor(x => x.GrievanceId)
    @Html.HiddenFor(x => x.RegistrationYear)

    <div class="modal-body pb-0 pt-3 px-3">
        <div class="accordion" id="accordionExample">
            <div class="row">
                <div class="accordion-item mb-2 col-6">
                    <h2 class="accordion-header" id="panelsStayOpen-headingOne">
                        <button class="accordion-button px-3 py-2 bg-primary text-white" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseOne" aria-expanded="true" aria-controls="panelsStayOpen-collapseOne">
                            @LabelDictionary["MatterSummary"]
                        </button>
                    </h2>
                    <div id="panelsStayOpen-collapseOne" class="accordion-collapse collapse show" aria-labelledby="panelsStayOpen-headingOne">
                        <div class="accordion-body">
                            <div class="row">
                                <div style="height:560px" class="overflow-auto">
                                    @Html.Raw(Model.Summary)
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-12">
                                    <div class="row">
                                        <table class='table table-bordered w-100 mb-0'>
                                            <tbody>
                                                <tr>
                                                    <td class="px-3 py-2 bg-primary text-white col-12" colspan="2">
                                                        @LabelDictionary["ObservationbyGACSecretariat"]:
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td class="align-top">
                                                        <span class="fw-semibold">@LabelDictionary["Observation"]</span>
                                                    </td>
                                                    <td style="width:83%" class="align-top">
                                                        @Model.ObservationText
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td class="align-top">
                                                        <span class="fw-semibold"> @LabelDictionary["AppealtobeAdmitted"]</span>
                                                    </td>
                                                    <td style="width:83%" class="align-top">
                                                        @Model.isAdmit
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
                <div class="accordion-item col-6">
                    <div class="bg-white gv-container-comparison-doc"></div>
                    <h2 class="accordion-header" id="panelsStayOpen-headingTwo">
                        <button class="accordion-button px-3 py-2 bg-primary text-white" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseTwo" aria-expanded="false" aria-controls="panelsStayOpen-collapseTwo">
                            @LabelDictionary["MemberOpinion"]
                        </button>
                    </h2>
                    <div id="panelsStayOpen-collapseTwo" class="accordion-collapse" aria-labelledby="panelsStayOpen-headingTwo">
                        <div class="accordion-body">
                            <div class="row mt-3">
                                @Html.HiddenFor(x => Model.GrievanceId)
                                @Html.HiddenFor(x => Model.RegistrationYear)
                                @Html.HiddenFor(x => Model.ParaId)
                                @if (Model.ChairpersonDecision != null && Model.ChairpersonDecision == "Y")
                                {
                                    <div class="col-12">
                                        <div class="row">
                                            <div class="col-12">
                                                <div class="alert alert-danger">
                                                    @LabelDictionary["Note"] @LabelDictionary["ChairpersonDecisionDetails"] @Model.LastActionDateTime
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-3">
                                                @LabelDictionary["Doyouagreewiththeappeal?"]  <span class="text-danger"> *</span>
                                            </div>
                                            <div class="col-9">
                                                @Html.Raw(Model.AgreeDisagree == "Y" ? "<span class='text-success'>" + @LabelDictionary["Agree"] + "</span>" : "<span class='text-danger'>" + @LabelDictionary["Disagree"] + "</span>")
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-3 mt-3">
                                                <span>@LabelDictionary["Remarks/Comments"]: </span>
                                            </div>
                                            <div class="col-9 mt-3">
                                                @Model.Recomendations
                                            </div>
                                        </div>
                                        <div class="row mt-3">
                                            <span>@LabelDictionary["DraftDecision"]:</span>
                                            <div style="height:560px" class="overflow-auto">
                                                @Html.Raw(Model.DraftDecision)
                                            </div>
                                        </div>
                                    </div>

                                }
                                else
                                {
                                    <div class="col-12 mt-0">
                                        <div class="row">
                                            <div class="col-3 mt-3">
                                                @LabelDictionary["Doyouagreewiththeappeal?"]
                                            </div>
                                            <div class="col-9 mt-3">
                                                @Html.RadioButtonFor(x => Model.AgreeDisagree, "Y", new { @class = "form-check-input" })
                                                <label class="form-check-label text-success me-3">
                                                    @LabelDictionary["Agree"]
                                                </label>
                                                @Html.RadioButtonFor(x => Model.AgreeDisagree, "N", new { @class = "form-check-input" })
                                                <label class="form-check-label text-danger">
                                                    @LabelDictionary["Disagree"]
                                                </label>
                                                <br />
                                                @Html.ValidationMessageFor(x => Model.AgreeDisagree)
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-3 mt-3">
                                                <span>@LabelDictionary["Remarks/Comments"]: </span><br />
                                                <span class="text-danger text-muted">@LabelDictionary["upto5000characters"]</span>
                                            </div>
                                            <div class="col-9 mt-3">
                                                @Html.TextAreaFor(x => Model.Recomendations, new { @class = "form-control", rows = 4, @maxlength = "5000" })
                                            </div>
                                        </div>
                                        <div class="row mt-2">
                                            <div class="col-lg-6 mb-0 p-0">
                                                <label class="form-label">@LabelDictionary["DraftDecision"]</label>
                                                <span class="font-sm ms-1">(@LabelDictionary["Max.Words"]: 5000)</span>
                                                <span class="text-danger ms-1">*</span>
                                            </div>
                                            <div class="col-lg-6 mb-0 p-0 text-end">
                                                <span class="text-muted font-md me-1">Last updated </span>@Html.Raw(Model.TimeDifference) <span class="text-muted font-md me-1"> ago</span>
                                                <span class="font-lg ms-1">
                                                    @Html.Raw(Model.IsWindowOpened == "N" ? "<i class='bx bxs-lock-open text-success' ></i>" : "<i class='bx bxs-lock text-danger' ></i>")
                                                </span>
                                                <a href="javascript:void(0);" data-tcid="dash-history-hidden" onclick="ShowComparsionHtmlReco($(this));" id="lblDashSelectedGround" title="View History"><i class="bx bx-history me-1 align-text-bottom" style="opacity: 0.6;"></i>View Updation History</a>
                                            </div>
                                            <div id="dash-history-hidden" class="d-none">
                                                @{ Html.RenderPartial("Forms/_ViewHistory", Model); }
                                            </div>
                                            <div class="col-lg-12 mb-3 p-0">
                                                @Html.TextAreaFor(x => x.DraftDecision, new { id = "txtEditor", @class = "form-control", rows = 4 })
                                                @Html.ValidationMessageFor(x => x.DraftDecision)
                                            </div>
                                        </div>
                                        <hr />
                                        <div class="row">
                                            <div class="col-12 text-center">
                                                @*<button type="button" class="btn btn-primary btnsuccess" onclick="SubmitDraftRecomendations($(this))"><i class="bx bxs-file align-middle  me-1"></i>@LabelDictionary["SaveDraft"]</button>*@
                                                <button type="button" class="btn btn-success btnsuccess" onclick="SubmitRecomendations($(this))"><i class="bx bx-check-circle align-middle  me-1"></i>@LabelDictionary["Submit"]</button>
                                                <button type="button" class="btn btn-outline-secondary" onclick="CloseTab($(this))" data-url="@Url.Action("UpdateWindowOpenedStatus", "GACGridViewInbox", new { Area = "GridView" })" data-qs="@SecureQueryString.SecureQueryString.Encrypt("RegistrationYear=" + @Model.RegistrationYear +"&GrievanceId="+Model.GrievanceId)" data-bs-dismiss="modal"><i class="bx bx-window-close align-middle me-1"></i> @LabelDictionary["Close"]</button>
                                            </div>
                                        </div>
                                    </div>
                                }

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="modal-footer justify-content-center">
    </div>
}
<script>
    $(document).ready(function () {
        if ('@Model.IsWindowOpened' == "Y") {
            $('#txtEditor').attr('readonly', true);
            $('.btnsuccess').hide();
            alertify.alert("<h5 class='m-0'><i class='bx bx-x-circle me-1'></i> Information</h5>", "@Html.Raw("This window is opened by " + @Model.OpenedBy + " as the decision on this appeal is being prepared by him/her. Please try after sometime.")", function () { });
        }
    });

</script>
<script>
    $.validator.unobtrusive.parse($(".frmGACRecomendations"));
    function SubmitRecomendations(element) {
        var form = element.closest('form');
        if (form.valid()) {
            $(".btn").attr("disabled", "disabled"); form.submit();
        }
    }
    CKEDITOR.config.height = '300'; CKEDITOR.config.allowedContent = true; CKEDITOR.config.protectedSource.push(/<i[^>]*><\/i>/g); CKEDITOR.config.autoParagraph = false;
    CKEDITOR.config.editorplaceholder = "@LabelDictionary["Typeyourdraftdecisionhere"] ...";
    CKEDITOR.config.removeButtons = 'Preview,Source,Save,NewPage,ExportPdf,Print,Templates,Find,SelectAll,Undo,Redo,Cut,Copy,Paste,PasteText,PasteFromWord,Outdent,Indent,Scayt,Form,Radio,TextField,Textarea,Select,Strike,Button,ImageButton,HiddenField,Checkbox,CopyFormatting,RemoveFormat,Blockquote,CreateDiv,BidiLtr,BidiRtl,Language,Anchor,Image,Flash,Smiley,PageBreak,Iframe,ShowBlocks,About,Replace,Styles,Font';
    CKEDITOR.config.removePlugins = 'uploadfile'; CKEDITOR.config.extraPlugins = 'wordcount';
    CKEDITOR.replace('txtEditor');
    function CloseTab(element) {
        var URL = element.data("url");
        var qs = element.data("qs");
        $.ajax({
            url: URL,
            type: "GET",
            data: { qs: qs },
            dataType: "JSON",
            success: function (data) {
                if (data == "S") {
                    $("#gv-action-modal").modal('hide');
                }
                $("#gv-action-modal").modal('hide');
            }
        });
    }
    function ShowComparsionHtmlReco(element) {
        var tcid = element.data('tcid'); var html = "";
        if (tcid) { html = $("#" + tcid).html(); } else { element.data('html'); }
        var ComparisonContainer = $(".gv-container-comparison-doc");
        ComparisonContainer.html('<div class="my-2 text-end"><a href="javascript:void(0);" class="btn btn-danger btn-xs" onclick="$(\'.gv-container-comparison-doc\').hide(\'fast\')">@LabelDictionary["Close"]</a></div><div class="font-lg" width="100%" height="93%;">' + html + '</div>');
        ComparisonContainer.show('fast'); ComparisonContainer.append('');
    }
</script>