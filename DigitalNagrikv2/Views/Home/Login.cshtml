@model DigitalNagrik.Models.LoginviaPassword
@{
    ViewBag.Title = "Login";
    Layout = "~/Views/Shared/_LayoutPublic.cshtml";
}

<section class="inner-page">
    <div class="container">
        @using (Html.BeginForm("LoginViaPassword", "Home", FormMethod.Post, new { id = "frm_Login", enctype = "multipart/form-data" }))
        {
            @Html.AntiForgeryToken()
            @Html.HiddenFor(x => x.HashPassword)
            @Html.HiddenFor(x => x.Seed)
            <div class="row">
                <div class="col-lg-8 mx-auto" style="height:auto;">
                    <div class="card">
                        <div class="card-body">
                            <img src="~/assets/img/Admin-login.png" class="img-fluid" />
                        </div>
                    </div>
                </div>
                <div class="col-lg-4 mx-auto" style="height:auto;">
                    <div class="card">
                        <div class="card-body">
                            <div class="mb-2 text-center row">
                                <h5 class="card-title text-primary"><i class="fa fa-user fa-2x"></i></h5>
                                <h3 class="card-title text-dark">Sign In</h3>
                            </div>
                            <hr>
                            <div class="mb-2 row">
                                <div class="col-12">
                                    <label class="custom-input-label mb-1">Email ID<span class="text-danger">*</span></label>
                                    @Html.TextBoxFor(x => x.EmailID, new { @id = "EmailID", @class = "form-control DisabledInputs", maxlength = "100", placeholder = "Email ID", @autocomplete = "off" })
                                    @Html.ValidationMessageFor(x => x.EmailID)
                                </div>
                            </div>
                            <div class="mb-2 row">
                                <div class="col-12">
                                    <label class="custom-input-label mb-1">Password<span class="text-danger">*</span></label>
                                    @Html.TextBoxFor(x => x.Password, new { @id = "Password", @class = "form-control DisabledInputs", @type = "Password", maxlength = "100", placeholder = "Password", @autocomplete = "off" })
                                    @Html.ValidationMessageFor(x => x.Password)
                                </div>
                            </div>
                            <div class="mb-4 row">
                                <div class="col-12">
                                    <label class="custom-input-label mb-1">Captcha<span class="text-danger">*</span></label>
                                    <div class="input-group">
                                        <span class="input-group-text" id="basic-addon1">
                                            <img id="CaptchaImage" alt="Captcha" src="@Url.Action("CaptchaImageNew", "Home", new { Area = "" })" />
                                            <a title="Click to refresh Captcha" onclick="RefreshCaptcha()"><i class="fa fa-refresh ms-2" aria-hidden="true"></i></a>
                                        </span>
                                        @Html.TextBoxFor(x => x.Captcha, new { @id = "txtCaptcha", @class = "form-control DisabledInputs", placeholder = "Enter Captcha", autocomplete = "off", maxlength = "6" })
                                    </div>
                                    <div id="SpanCaptchaValidation">
                                        @Html.ValidationMessageFor(x => x.Captcha)
                                    </div>
                                </div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-12 text-center">
                                    <button type="button" class="btn btn-success" id="btnSubmit"><i class="fa fa-lock"></i>&nbsp;Login</button>
                                    <button type="button" class="btn btn-danger" id="btnCancel"><i class=" fa fa-close"></i>&nbsp;Cancel </button>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer text-muted">
                            <div class="p-1 bg-light text-muted radius-2 text-center mb-1" style="font-size:12px;">
                                <i class="fa fa-exclamation-triangle me-1 blink text-danger"></i>
                                Your IP <span class="text-orange fw-600 mx-1">@DigitalNagrik.Models.BALCommon.GetIPAddress()</span> is being monitored for security purpose
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>
</section>
<script src=@Url.Content("~/assets/js/sha256.js")></script>
<script>
     function RefreshCaptcha() {
        $.ajax({
            url: '@Url.Action("CaptchaImage", "Home", new { area = "" })',
            data: {},
            success: function (data) {
                $("#CaptchaImage").html(data);
            }
        });
        $("#CaptchaImage").attr("src", '@Url.Action("CaptchaImageNew", "Home", new { area = "" })?' + new Date().getTime());
    };
    function ValidateCaptcha() {
        var Result = false;
        var CaptchaCD = $("#txtCaptcha").val();
        $.ajax({
            url: '@Url.Action("CheckCaptcha", "Home", new { area = "" })',
            type: "GET", async: false,
            data: { CaptchaCD: CaptchaCD },
            dataType: "JSON",
            success: function (result) {
                if (result == true) {
                    Result = true;
                }
            }
        });
        return Result;
    };
    $("#btnSubmit").click(function () {
        if ($("#frm_Login").valid()) {
                if (ValidateCaptcha()) {
                    $('#SpanCaptchaValidation').html('');
                   /* $('.DisabledInputs').prop('disabled', true);*/
                    var seed = Math.floor(100000 + Math.random() * 900000);
                    $("#HashPassword").val(sha256(seed + sha256($('#Password').val())));
                    $("#Seed").val(seed);
                    $('#Password').val('xxxxxxxxxxxxxxxx');
                    $('#frm_Login').submit();
                }
                else {
                    RefreshCaptcha();
                    $('#SpanCaptchaValidation').html("Invalid Captcha.");
                    $('#SpanCaptchaValidation').addClass("text-danger");
                    $('#SpanCaptchaValidation').removeClass("alert alert-danger mt-1");
                }
        }
    });
</script>

